<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QuickCW.CWFastPrior &mdash; QuickCW  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            QuickCW
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QuickCW</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">QuickCW.CWFastPrior</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for QuickCW.CWFastPrior</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;C 2021 Bence Becsy</span>
<span class="sd">MCMC for CW fast likelihood (w/ Neil Cornish and Matthew Digman)</span>
<span class="sd">Helpers for Getting Prior Draws&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1">#np.seterr(all=&#39;raise&#39;)</span>
<span class="kn">import</span> <span class="nn">numba</span> <span class="k">as</span> <span class="nn">nb</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">numba.experimental</span> <span class="kn">import</span> <span class="n">jitclass</span>
<span class="kn">from</span> <span class="nn">numba.typed</span> <span class="kn">import</span> <span class="n">List</span>

<span class="c1">#import scipy as sc</span>
<span class="c1">#from scipy.stats.uniform import uni_pdf</span>
<span class="c1">#from scipy.stats.multivariate_normal import norm_pdf</span>
<span class="c1">#from numba_stats import norm as norm_numba</span>
<span class="c1">#from numba_stats import uniform as uniform_numba</span>

<span class="c1">################################################################################</span>
<span class="c1">#</span>
<span class="c1">#MY VERSION OF GETTING THE LOG PRIOR</span>
<span class="c1">#</span>
<span class="c1">################################################################################</span>
<div class="viewcode-block" id="FastPrior"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.FastPrior">[docs]</a><span class="k">class</span> <span class="nc">FastPrior</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;helper class to set up information about priors</span>

<span class="sd">    :param pta:</span>
<span class="sd">    enterprise PTA object</span>
<span class="sd">    :param psrs:</span>
<span class="sd">    list of enterprise pulsar objects</span>
<span class="sd">    :param par_names_cw_ext:</span>
<span class="sd">    list of projection parameters (previously called extrinsic parameters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pta</span><span class="p">,</span> <span class="n">psrs</span><span class="p">,</span> <span class="n">par_names_cw_ext</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pta</span> <span class="o">=</span> <span class="n">pta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">pta</span><span class="o">.</span><span class="n">param_names</span><span class="p">)</span>
        <span class="n">uniform_pars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uf_lows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uf_highs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lin_exp_pars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">le_lows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">le_highs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">normal_pars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nm_mus</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nm_sigs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dm_pars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dm_dists</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dm_errs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dm_dist_lows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">px_pars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">px_mus</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">px_errs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">px_dist_lows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#track parameters that are normal and distance so we can apply a cutoff to them</span>
        <span class="n">normal_dist_pars</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nm_dist_lows</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#store ranges for extrinsic parameters</span>
        <span class="n">cw_ext_lows</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cw_ext_highs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cw_pars</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">pta</span><span class="o">.</span><span class="n">params</span><span class="p">:</span>
            <span class="c1">#print(par)</span>
            <span class="k">if</span> <span class="s2">&quot;Uniform&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="p">:</span>
                <span class="n">uniform_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">uf_lows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">uf_highs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="s2">&quot;LinearExp&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="p">:</span>
                <span class="n">lin_exp_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">le_lows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">le_highs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="s2">&quot;Normal&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="p">:</span>
                <span class="n">normal_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">nm_mus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">nm_sigs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">if</span> <span class="s2">&quot;_cw0_p_dist&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="c1">#find the corresponding pulsar distance so we can append it</span>
                    <span class="n">normal_dist_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">psr</span> <span class="ow">in</span> <span class="n">psrs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">psr</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                            <span class="c1">#this should be the lower cutoff of dist_delta such that dist_mu + dist_sigma*dist_delta=0</span>
                            <span class="n">nm_dist_lows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">psr</span><span class="o">.</span><span class="n">pdist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">psr</span><span class="o">.</span><span class="n">pdist</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="k">break</span>
            <span class="k">elif</span> <span class="s2">&quot;DMDist&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="p">:</span>
                <span class="n">dm_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">dm_dists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">dm_errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">dm_dist_lows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;PXDist&quot;</span> <span class="ow">in</span> <span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="p">:</span>
                <span class="n">px_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">px_dist</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">px_dist_err</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">px_mus</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">px_dist</span><span class="p">)</span>
                <span class="n">px_errs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">px_dist_err</span><span class="o">/</span><span class="n">px_dist</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                <span class="n">px_dist_lows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">par</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">par_names_cw_ext</span><span class="p">:</span>
                <span class="n">cw_pars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">cw_ext_lows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="n">cw_ext_highs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">par</span><span class="o">.</span><span class="n">_typename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_lows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uf_lows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_highs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">uf_highs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_lows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">le_lows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_highs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">le_highs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_mus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nm_mus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_sigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nm_sigs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_dists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dm_dists</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dm_errs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_mus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">px_mus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_errs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">px_errs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">u_par</span><span class="p">)</span> <span class="k">for</span> <span class="n">u_par</span> <span class="ow">in</span> <span class="n">uniform_pars</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l_par</span><span class="p">)</span> <span class="k">for</span> <span class="n">l_par</span> <span class="ow">in</span> <span class="n">lin_exp_pars</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">n_par</span><span class="p">)</span> <span class="k">for</span> <span class="n">n_par</span> <span class="ow">in</span> <span class="n">normal_pars</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dm_par</span><span class="p">)</span> <span class="k">for</span> <span class="n">dm_par</span> <span class="ow">in</span> <span class="n">dm_pars</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">px_par</span><span class="p">)</span> <span class="k">for</span> <span class="n">px_par</span> <span class="ow">in</span> <span class="n">px_pars</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cw_ext_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">c_par</span><span class="p">)</span> <span class="k">for</span> <span class="n">c_par</span> <span class="ow">in</span> <span class="n">cw_pars</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cw_ext_lows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cw_ext_lows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cw_ext_highs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cw_ext_highs</span><span class="p">)</span>

        <span class="c1">#logic for cutting off normally distributed distances so they don&#39;t go below 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_dist_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">n_par</span><span class="p">)</span> <span class="k">for</span> <span class="n">n_par</span> <span class="ow">in</span> <span class="n">normal_dist_pars</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_dist_lows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nm_dist_lows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_dist_highs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normal_dist_lows</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dm_dist_lows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dm_dist_lows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_dist_highs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dm_dist_lows</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_dist_lows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">px_dist_lows</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_dist_highs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px_dist_lows</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cut_lows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">normal_dist_lows</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dm_dist_lows</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">px_dist_lows</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_highs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">normal_dist_highs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dm_dist_highs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">px_dist_highs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_par_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">uniform_par_ids</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_par_ids</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">normal_dist_par_ids</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dm_par_ids</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">px_par_ids</span><span class="p">])</span>

        <span class="c1">#uniform prior is independent of value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_uniform</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uniform_lows</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
            <span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_uniform</span> <span class="o">+=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">high</span><span class="o">-</span><span class="n">low</span><span class="p">)</span>

        <span class="c1">#linear exponential prior has component independent of value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_lin_exp</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">low</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
            <span class="n">high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_lin_exp</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">high</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">low</span><span class="p">)</span>
            <span class="c1">#self.global_lin_exp += -np.log(high-low)</span>

        <span class="c1">#normal prior has component independent of value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_normal</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">normal_mus</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">global_normal</span> <span class="o">+=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>

        <span class="c1">#dm prior has component independent of the value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_dm</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dm_dists</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
            <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>

            <span class="n">boxheight</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="n">dist</span><span class="o">+</span><span class="n">err</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">dist</span><span class="o">-</span><span class="n">err</span><span class="p">))</span>
            <span class="n">gaussheight</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

            <span class="n">area</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="n">boxheight</span><span class="o">/</span><span class="n">gaussheight</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">global_dm</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">boxheight</span><span class="o">/</span><span class="n">area</span><span class="p">)</span>

        <span class="c1">#part of the likelihood that is the same independent of the parameter values for all points with finite log prior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_common</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_uniform</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">global_lin_exp</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">global_normal</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">global_dm</span>

<div class="viewcode-block" id="FastPrior.get_lnprior"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.FastPrior.get_lnprior">[docs]</a>    <span class="k">def</span> <span class="nf">get_lnprior</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper to get ln prior&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_lnprior_helper</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">normal_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_mus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_sigs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">dm_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_dists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_errs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">px_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_mus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_errs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">global_common</span><span class="p">)</span></div>

<div class="viewcode-block" id="FastPrior.get_sample"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.FastPrior.get_sample">[docs]</a>    <span class="k">def</span> <span class="nf">get_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;wrapper to quickly return random prior draw for the (idx)th parameter&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_sample_helper</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">normal_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_mus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_sigs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">dm_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_dists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_errs</span><span class="p">,</span>\
                                      <span class="bp">self</span><span class="o">.</span><span class="n">px_par_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_mus</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_errs</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="get_sample_helper_full"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_sample_helper_full">[docs]</a><span class="nd">@njit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_sample_helper_full</span><span class="p">(</span><span class="n">n_par</span><span class="p">,</span><span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">uniform_lows</span><span class="p">,</span> <span class="n">uniform_highs</span><span class="p">,</span>
                           <span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">lin_exp_highs</span><span class="p">,</span>
                           <span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">normal_mus</span><span class="p">,</span> <span class="n">normal_sigs</span><span class="p">,</span>
                           <span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">dm_dists</span><span class="p">,</span> <span class="n">dm_errs</span><span class="p">,</span>
                           <span class="n">px_par_ids</span><span class="p">,</span> <span class="n">px_mus</span><span class="p">,</span> <span class="n">px_errs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;jittable helper for prior draws</span>

<span class="sd">    :param n_par:</span>
<span class="sd">    Number of parameters in likelihood/prior</span>
<span class="sd">    :param uniform_par_ids:</span>
<span class="sd">    Indices of parameters with uniform prior</span>
<span class="sd">    :param uniform_lows:</span>
<span class="sd">    Lower prior bounds of uniform prior parameters</span>
<span class="sd">    :param uniform_highs:</span>
<span class="sd">    Upper prior bounds of uniform prior parameters</span>
<span class="sd">    :param lin_exp_par_ids:</span>
<span class="sd">    Indices of parameters with linear exponential prior</span>
<span class="sd">    :param lin_exp_lows:</span>
<span class="sd">    Lower prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param lin_exp_highs:</span>
<span class="sd">    Upper prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param normal_par_ids:</span>
<span class="sd">    Indices of parameters with normal prior</span>
<span class="sd">    :param normal_mus:</span>
<span class="sd">    Means of normal prior parameters</span>
<span class="sd">    :param normal_sigs:</span>
<span class="sd">    Standard deviations of normal prior parameters</span>
<span class="sd">    :param dm_par_ids:</span>
<span class="sd">    Indices of parameters with DM distance prior</span>
<span class="sd">    :param dm_dists:</span>
<span class="sd">    Mean distances of DM distance prior parameters</span>
<span class="sd">    :param dm_errs:</span>
<span class="sd">    Errors of DM distance prior parameters</span>
<span class="sd">    :param px_par_ids:</span>
<span class="sd">    Indices of parameters with parallax distance prior</span>
<span class="sd">    :param px_mus:</span>
<span class="sd">    Means of parallax distance prior parameters</span>
<span class="sd">    :param px_errs:</span>
<span class="sd">    Errors of parallax distance prior parameters</span>

<span class="sd">    :return res:</span>
<span class="sd">    Array of prior draws</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_par</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">itrp</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">uniform_par_ids</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">uniform_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">],</span> <span class="n">uniform_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">itrp</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lin_exp_par_ids</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lin_exp_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">],</span> <span class="mi">10</span><span class="o">**</span><span class="n">lin_exp_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">itrp</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">normal_par_ids</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">normal_mus</span><span class="p">[</span><span class="n">itrp</span><span class="p">],</span> <span class="n">normal_sigs</span><span class="p">[</span><span class="n">itrp</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">itrp</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dm_par_ids</span><span class="p">):</span>
        <span class="n">boxheight</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span><span class="o">+</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">])</span><span class="o">-</span><span class="p">(</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span><span class="o">-</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]))</span>
        <span class="n">gaussheight</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">area</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="n">boxheight</span><span class="o">/</span><span class="n">gaussheight</span>
        
        <span class="c1">#probability of being in the uniform part</span>
        <span class="n">boxprob</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">area</span>
        
        <span class="c1">#decide if we are in the middle or not</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha</span><span class="o">&lt;</span><span class="n">boxprob</span><span class="p">:</span>
            <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span><span class="o">-</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">],</span> <span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span><span class="o">+</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span><span class="o">+</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">+</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span><span class="o">-</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">itrp</span><span class="p">,</span><span class="n">idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">px_par_ids</span><span class="p">):</span>
        <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">px_mus</span><span class="p">[</span><span class="n">itrp</span><span class="p">],</span> <span class="n">px_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">res</span></div>

<div class="viewcode-block" id="get_sample_helper"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_sample_helper">[docs]</a><span class="k">def</span> <span class="nf">get_sample_helper</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">uniform_lows</span><span class="p">,</span> <span class="n">uniform_highs</span><span class="p">,</span>
                           <span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">lin_exp_highs</span><span class="p">,</span>
                           <span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">normal_mus</span><span class="p">,</span> <span class="n">normal_sigs</span><span class="p">,</span>
                           <span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">dm_dists</span><span class="p">,</span> <span class="n">dm_errs</span><span class="p">,</span>
                           <span class="n">px_par_ids</span><span class="p">,</span> <span class="n">px_mus</span><span class="p">,</span> <span class="n">px_errs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;jittable helper for prior draws - same as get_sample_helper_full but only for a single parameter</span>

<span class="sd">    :param idx:</span>
<span class="sd">    Index of parameters for which we want a prior draw</span>
<span class="sd">    :param uniform_par_ids:</span>
<span class="sd">    Indices of parameters with uniform prior</span>
<span class="sd">    :param uniform_lows:</span>
<span class="sd">    Lower prior bounds of uniform prior parameters</span>
<span class="sd">    :param uniform_highs:</span>
<span class="sd">    Upper prior bounds of uniform prior parameters</span>
<span class="sd">    :param lin_exp_par_ids:</span>
<span class="sd">    Indices of parameters with linear exponential prior</span>
<span class="sd">    :param lin_exp_lows:</span>
<span class="sd">    Lower prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param lin_exp_highs:</span>
<span class="sd">    Upper prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param normal_par_ids:</span>
<span class="sd">    Indices of parameters with normal prior</span>
<span class="sd">    :param normal_mus:</span>
<span class="sd">    Means of normal prior parameters</span>
<span class="sd">    :param normal_sigs:</span>
<span class="sd">    Standard deviations of normal prior parameters</span>
<span class="sd">    :param dm_par_ids:</span>
<span class="sd">    Indices of parameters with DM distance prior</span>
<span class="sd">    :param dm_dists:</span>
<span class="sd">    Mean distances of DM distance prior parameters</span>
<span class="sd">    :param dm_errs:</span>
<span class="sd">    Errors of DM distance prior parameters</span>
<span class="sd">    :param px_par_ids:</span>
<span class="sd">    Indices of parameters with parallax distance prior</span>
<span class="sd">    :param px_mus:</span>
<span class="sd">    Means of parallax distance prior parameters</span>
<span class="sd">    :param px_errs:</span>
<span class="sd">    Errors of parallax distance prior parameters</span>

<span class="sd">    :return:</span>
<span class="sd">    Prior draw of the parameter of interest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">uniform_par_ids</span><span class="p">:</span>
        <span class="n">iii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">uniform_par_ids</span><span class="o">==</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">uniform_lows</span><span class="p">[</span><span class="n">iii</span><span class="p">],</span> <span class="n">uniform_highs</span><span class="p">[</span><span class="n">iii</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">lin_exp_par_ids</span><span class="p">:</span>
        <span class="n">iii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">lin_exp_par_ids</span><span class="o">==</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">lin_exp_lows</span><span class="p">[</span><span class="n">iii</span><span class="p">],</span> <span class="mi">10</span><span class="o">**</span><span class="n">lin_exp_highs</span><span class="p">[</span><span class="n">iii</span><span class="p">]))</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">normal_par_ids</span><span class="p">:</span>
        <span class="n">iii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">normal_par_ids</span><span class="o">==</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">normal_mus</span><span class="p">[</span><span class="n">iii</span><span class="p">],</span> <span class="n">normal_sigs</span><span class="p">[</span><span class="n">iii</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">dm_par_ids</span><span class="p">:</span>
        <span class="n">iii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dm_par_ids</span><span class="o">==</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">boxheight</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">((</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span><span class="o">+</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">])</span><span class="o">-</span><span class="p">(</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span><span class="o">-</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">]))</span>
        <span class="n">gaussheight</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">area</span> <span class="o">=</span> <span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">*</span><span class="n">boxheight</span><span class="o">/</span><span class="n">gaussheight</span>

        <span class="c1">#probability of being in the uniform part</span>
        <span class="n">boxprob</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">area</span>

        <span class="c1">#decide if we are in the middle or not</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alpha</span><span class="o">&lt;</span><span class="n">boxprob</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span><span class="o">-</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">],</span> <span class="n">dm_dists</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span><span class="o">+</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span><span class="o">+</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">x</span><span class="o">+</span><span class="n">dm_dists</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span><span class="o">-</span><span class="n">dm_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">iii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">px_par_ids</span><span class="o">==</span><span class="n">idx</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">px_mus</span><span class="p">[</span><span class="n">iii</span><span class="p">],</span> <span class="n">px_errs</span><span class="p">[</span><span class="n">iii</span><span class="p">])</span></div>

<div class="viewcode-block" id="get_lnprior_helper"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_lnprior_helper">[docs]</a><span class="nd">@njit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_lnprior_helper</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">uniform_lows</span><span class="p">,</span> <span class="n">uniform_highs</span><span class="p">,</span>\
                           <span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">lin_exp_highs</span><span class="p">,</span>\
                           <span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">normal_mus</span><span class="p">,</span> <span class="n">normal_sigs</span><span class="p">,</span>\
                           <span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">dm_dists</span><span class="p">,</span> <span class="n">dm_errs</span><span class="p">,</span>\
                           <span class="n">px_par_ids</span><span class="p">,</span> <span class="n">px_mus</span><span class="p">,</span> <span class="n">px_errs</span><span class="p">,</span>\
                           <span class="n">global_common</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;jittable helper for calculating the log prior</span>

<span class="sd">    :param x0:</span>
<span class="sd">    Array of parameters for which we want to calculate the prior</span>
<span class="sd">    :param uniform_par_ids:</span>
<span class="sd">    Indices of parameters with uniform prior</span>
<span class="sd">    :param uniform_lows:</span>
<span class="sd">    Lower prior bounds of uniform prior parameters</span>
<span class="sd">    :param uniform_highs:</span>
<span class="sd">    Upper prior bounds of uniform prior parameters</span>
<span class="sd">    :param lin_exp_par_ids:</span>
<span class="sd">    Indices of parameters with linear exponential prior</span>
<span class="sd">    :param lin_exp_lows:</span>
<span class="sd">    Lower prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param lin_exp_highs:</span>
<span class="sd">    Upper prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param normal_par_ids:</span>
<span class="sd">    Indices of parameters with normal prior</span>
<span class="sd">    :param normal_mus:</span>
<span class="sd">    Means of normal prior parameters</span>
<span class="sd">    :param normal_sigs:</span>
<span class="sd">    Standard deviations of normal prior parameters</span>
<span class="sd">    :param dm_par_ids:</span>
<span class="sd">    Indices of parameters with DM distance prior</span>
<span class="sd">    :param dm_dists:</span>
<span class="sd">    Mean distances of DM distance prior parameters</span>
<span class="sd">    :param dm_errs:</span>
<span class="sd">    Errors of DM distance prior parameters</span>
<span class="sd">    :param px_par_ids:</span>
<span class="sd">    Indices of parameters with parallax distance prior</span>
<span class="sd">    :param px_mus:</span>
<span class="sd">    Means of parallax distance prior parameters</span>
<span class="sd">    :param px_errs:</span>
<span class="sd">    Errors of parallax distance prior parameters</span>
<span class="sd">    :param global_common:</span>
<span class="sd">    Part of the log prior independent of the parameter values</span>

<span class="sd">    :return log_prior:</span>
<span class="sd">    Log prior</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log_prior</span> <span class="o">=</span> <span class="n">global_common</span>

    <span class="c1">#loop through uniform parameters and make sure all are in range</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">uniform_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">uniform_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">uniform_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">uniform_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">par_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">low</span><span class="o">&gt;</span><span class="n">value</span> <span class="ow">or</span> <span class="n">value</span><span class="o">&gt;</span><span class="n">high</span><span class="p">:</span>
            <span class="n">log_prior</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1">#loop through linear exponential parameters</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">lin_exp_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">lin_exp_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">lin_exp_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">lin_exp_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">par_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">low</span><span class="o">&gt;</span><span class="n">value</span> <span class="ow">or</span> <span class="n">value</span><span class="o">&gt;</span><span class="n">high</span><span class="p">:</span>
            <span class="n">log_prior</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="c1">#from enterprise</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log_prior</span> <span class="o">+=</span> <span class="n">value</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="c1">#from enterprise</span>

    <span class="c1">#loop through normal parameters</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">normal_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">normal_mus</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">normal_sigs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">normal_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">par_id</span><span class="p">]</span>
        <span class="n">log_prior</span> <span class="o">+=</span> <span class="o">-</span><span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sig</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#log_pdf_got</span>

    <span class="c1">#loop through dm distance parameters</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">dm_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">dm_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">par_id</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">value</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">dist</span><span class="o">-</span><span class="n">err</span><span class="p">):</span>
            <span class="n">log_prior</span> <span class="o">+=</span> <span class="o">-</span><span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="p">(</span><span class="n">dist</span><span class="o">-</span><span class="n">err</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">value</span><span class="o">&gt;=</span><span class="p">(</span><span class="n">dist</span><span class="o">+</span><span class="n">err</span><span class="p">):</span>
            <span class="n">log_prior</span> <span class="o">+=</span> <span class="o">-</span><span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="p">(</span><span class="n">dist</span><span class="o">+</span><span class="n">err</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#loop trhough parallax distance parameters</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">px_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ll</span><span class="p">):</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="n">px_mus</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">pi_err</span> <span class="o">=</span> <span class="n">px_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">px_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">x0</span><span class="p">[</span><span class="n">par_id</span><span class="p">]</span>

        <span class="n">log_prior</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">pi_err</span><span class="o">*</span><span class="n">value</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">pi</span><span class="o">-</span><span class="n">value</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">log_prior</span></div>

<div class="viewcode-block" id="get_lnprior"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_lnprior">[docs]</a><span class="k">def</span> <span class="nf">get_lnprior</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">FPI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;wrapper to get lnprior from jitted helper</span>

<span class="sd">    :param x0:</span>
<span class="sd">    Array of parameter values for which we want to calculate the prior</span>
<span class="sd">    :param FPI:</span>
<span class="sd">    FastPriorInfo object</span>

<span class="sd">    :return:</span>
<span class="sd">    log prior</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_lnprior_helper</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">,</span>\
                                         <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">,</span>\
                                         <span class="n">FPI</span><span class="o">.</span><span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">normal_mus</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">normal_sigs</span><span class="p">,</span>\
                                         <span class="n">FPI</span><span class="o">.</span><span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">dm_dists</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">dm_errs</span><span class="p">,</span>\
                                         <span class="n">FPI</span><span class="o">.</span><span class="n">px_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">px_mus</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">px_errs</span><span class="p">,</span>\
                                         <span class="n">FPI</span><span class="o">.</span><span class="n">global_common</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_lnprior_array"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_lnprior_array">[docs]</a><span class="k">def</span> <span class="nf">get_lnprior_array</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">FPI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;wrapper to get lnprior from jitted helper</span>

<span class="sd">    :param samples:</span>
<span class="sd">    2d array of parameter sets for which we want to calculate the prior</span>
<span class="sd">    :param FPI:</span>
<span class="sd">    FastPriorInfo object</span>

<span class="sd">    :return:</span>
<span class="sd">    Array of log prior values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">get_lnprior_helper_array</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">,</span>\
                                           <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">,</span>\
                                           <span class="n">FPI</span><span class="o">.</span><span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">normal_mus</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">normal_sigs</span><span class="p">,</span>\
                                           <span class="n">FPI</span><span class="o">.</span><span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">dm_dists</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">dm_errs</span><span class="p">,</span>\
                                           <span class="n">FPI</span><span class="o">.</span><span class="n">px_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">px_mus</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">px_errs</span><span class="p">,</span>\
                                           <span class="n">FPI</span><span class="o">.</span><span class="n">global_common</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_lnprior_helper_array"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_lnprior_helper_array">[docs]</a><span class="nd">@njit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">get_lnprior_helper_array</span><span class="p">(</span><span class="n">x0s</span><span class="p">,</span> <span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">uniform_lows</span><span class="p">,</span> <span class="n">uniform_highs</span><span class="p">,</span>\
                           <span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">lin_exp_highs</span><span class="p">,</span>\
                           <span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">normal_mus</span><span class="p">,</span> <span class="n">normal_sigs</span><span class="p">,</span>\
                           <span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">dm_dists</span><span class="p">,</span> <span class="n">dm_errs</span><span class="p">,</span>\
                           <span class="n">px_par_ids</span><span class="p">,</span> <span class="n">px_mus</span><span class="p">,</span> <span class="n">px_errs</span><span class="p">,</span>\
                           <span class="n">global_common</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;jittable helper for calculating the log prior for an array of points</span>
<span class="sd">    same as get_lnprior_helper, but can be called on an array of parameters</span>

<span class="sd">    :param x0s:</span>
<span class="sd">    2D array of multiple parameter sets for which we want to calculate the prior</span>
<span class="sd">    :param uniform_par_ids:</span>
<span class="sd">    Indices of parameters with uniform prior</span>
<span class="sd">    :param uniform_lows:</span>
<span class="sd">    Lower prior bounds of uniform prior parameters</span>
<span class="sd">    :param uniform_highs:</span>
<span class="sd">    Upper prior bounds of uniform prior parameters</span>
<span class="sd">    :param lin_exp_par_ids:</span>
<span class="sd">    Indices of parameters with linear exponential prior</span>
<span class="sd">    :param lin_exp_lows:</span>
<span class="sd">    Lower prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param lin_exp_highs:</span>
<span class="sd">    Upper prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param normal_par_ids:</span>
<span class="sd">    Indices of parameters with normal prior</span>
<span class="sd">    :param normal_mus:</span>
<span class="sd">    Means of normal prior parameters</span>
<span class="sd">    :param normal_sigs:</span>
<span class="sd">    Standard deviations of normal prior parameters</span>
<span class="sd">    :param dm_par_ids:</span>
<span class="sd">    Indices of parameters with DM distance prior</span>
<span class="sd">    :param dm_dists:</span>
<span class="sd">    Mean distances of DM distance prior parameters</span>
<span class="sd">    :param dm_errs:</span>
<span class="sd">    Errors of DM distance prior parameters</span>
<span class="sd">    :param px_par_ids:</span>
<span class="sd">    Indices of parameters with parallax distance prior</span>
<span class="sd">    :param px_mus:</span>
<span class="sd">    Means of parallax distance prior parameters</span>
<span class="sd">    :param px_errs:</span>
<span class="sd">    Errors of parallax distance prior parameters</span>
<span class="sd">    :param global_common:</span>
<span class="sd">    Part of the log prior independent of the parameter values</span>

<span class="sd">    :return log_priors:</span>
<span class="sd">    Array of log prior values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">npoint</span> <span class="o">=</span> <span class="n">x0s</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">log_priors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">npoint</span><span class="p">)</span><span class="o">+</span><span class="n">global_common</span>

    <span class="c1">#loop through uniform parameters and make sure all are in range</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">uniform_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">uniform_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">uniform_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">uniform_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">log_priors</span><span class="p">[(</span><span class="n">low</span><span class="o">&gt;</span><span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">]</span><span class="o">&gt;</span><span class="n">high</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1">#loop through linear exponential parameters</span>
    <span class="n">nn</span> <span class="o">=</span> <span class="n">lin_exp_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nn</span><span class="p">):</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">lin_exp_lows</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">lin_exp_highs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">lin_exp_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">log_priors</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="c1">#from enterprise</span>
        <span class="n">log_priors</span><span class="p">[(</span><span class="n">low</span><span class="o">&gt;</span><span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">])</span><span class="o">|</span><span class="p">(</span><span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">]</span><span class="o">&gt;</span><span class="n">high</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="c1">#loop through normal parameters</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">normal_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">normal_mus</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">normal_sigs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">normal_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">log_priors</span><span class="p">[:]</span> <span class="o">+=</span> <span class="o">-</span><span class="p">(</span><span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">]</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sig</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#log_pdf_got</span>

    <span class="c1">#loop through dm distance parameters</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">dm_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">dm_dists</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">dm_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">dm_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">]</span>

        <span class="n">log_priors</span><span class="p">[</span><span class="n">value</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">dist</span><span class="o">-</span><span class="n">err</span><span class="p">)]</span> <span class="o">+=</span> <span class="o">-</span><span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="p">(</span><span class="n">dist</span><span class="o">-</span><span class="n">err</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">log_priors</span><span class="p">[</span><span class="n">value</span><span class="o">&gt;=</span><span class="p">(</span><span class="n">dist</span><span class="o">+</span><span class="n">err</span><span class="p">)]</span> <span class="o">+=</span> <span class="o">-</span><span class="p">(</span><span class="n">value</span><span class="o">-</span><span class="p">(</span><span class="n">dist</span><span class="o">+</span><span class="n">err</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">0.25</span><span class="o">*</span><span class="n">err</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1">#loop trhough parallax distance parameters</span>
    <span class="n">ll</span> <span class="o">=</span> <span class="n">px_par_ids</span><span class="o">.</span><span class="n">size</span>
    <span class="k">for</span> <span class="n">itrp</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ll</span><span class="p">):</span>
        <span class="n">pi</span> <span class="o">=</span> <span class="n">px_mus</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">pi_err</span> <span class="o">=</span> <span class="n">px_errs</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>
        <span class="n">par_id</span> <span class="o">=</span> <span class="n">px_par_ids</span><span class="p">[</span><span class="n">itrp</span><span class="p">]</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">x0s</span><span class="p">[:,</span><span class="n">par_id</span><span class="p">]</span>

        <span class="n">log_priors</span><span class="p">[:]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">pi_err</span><span class="o">*</span><span class="n">value</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">pi</span><span class="o">-</span><span class="n">value</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">log_priors</span></div>

<div class="viewcode-block" id="get_sample_idxs"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_sample_idxs">[docs]</a><span class="k">def</span> <span class="nf">get_sample_idxs</span><span class="p">(</span><span class="n">old_point</span><span class="p">,</span><span class="n">idx_choose</span><span class="p">,</span><span class="n">FPI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get just some indexes drawn from a prior</span>

<span class="sd">    :param old_point:</span>
<span class="sd">    Old array of parameters</span>
<span class="sd">    :param idx_choose:</span>
<span class="sd">    List of indices for which we want to drawn from the prior</span>
<span class="sd">    :param FPI:</span>
<span class="sd">    FastPriorInfo object</span>

<span class="sd">    :return new_point:</span>
<span class="sd">    New array of parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_point</span> <span class="o">=</span> <span class="n">old_point</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">get_sample_full</span><span class="p">(</span><span class="n">new_point</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">FPI</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idx_choose</span><span class="p">:</span>
        <span class="n">new_point</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">new_point</span></div>

<div class="viewcode-block" id="get_sample_full"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_sample_full">[docs]</a><span class="k">def</span> <span class="nf">get_sample_full</span><span class="p">(</span><span class="n">n_par</span><span class="p">,</span><span class="n">FPI</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;helper to get a full prior draw sample</span>

<span class="sd">    :param n_par:</span>
<span class="sd">    Number of parameters</span>
<span class="sd">    :param FPI:</span>
<span class="sd">    FastPriorInfo object</span>

<span class="sd">    :return new_point:</span>
<span class="sd">    Array with parameters drawn from their priors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">new_point</span> <span class="o">=</span> <span class="n">get_sample_helper_full</span><span class="p">(</span><span class="n">n_par</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">,</span>\
                                              <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">,</span>\
                                              <span class="n">FPI</span><span class="o">.</span><span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">normal_mus</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">normal_sigs</span><span class="p">,</span>\
                                              <span class="n">FPI</span><span class="o">.</span><span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">dm_dists</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">dm_errs</span><span class="p">,</span>\
                                              <span class="n">FPI</span><span class="o">.</span><span class="n">px_par_ids</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">px_mus</span><span class="p">,</span> <span class="n">FPI</span><span class="o">.</span><span class="n">px_errs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_point</span></div>

<div class="viewcode-block" id="FastPriorInfo"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.FastPriorInfo">[docs]</a><span class="nd">@jitclass</span><span class="p">([(</span><span class="s1">&#39;uniform_par_ids&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">[:]),(</span><span class="s1">&#39;uniform_lows&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),(</span><span class="s1">&#39;uniform_highs&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),</span>\
           <span class="p">(</span><span class="s1">&#39;lin_exp_par_ids&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">[:]),(</span><span class="s1">&#39;lin_exp_lows&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),(</span><span class="s1">&#39;lin_exp_highs&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),</span>\
           <span class="p">(</span><span class="s1">&#39;normal_par_ids&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">[:]),(</span><span class="s1">&#39;normal_mus&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),(</span><span class="s1">&#39;normal_sigs&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),</span>\
           <span class="p">(</span><span class="s1">&#39;dm_par_ids&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">[:]),(</span><span class="s1">&#39;dm_dists&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),(</span><span class="s1">&#39;dm_errs&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),</span>\
           <span class="p">(</span><span class="s1">&#39;px_par_ids&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">[:]),(</span><span class="s1">&#39;px_mus&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),(</span><span class="s1">&#39;px_errs&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),</span>\
           <span class="p">(</span><span class="s1">&#39;cut_par_ids&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">[:]),(</span><span class="s1">&#39;cut_lows&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),(</span><span class="s1">&#39;cut_highs&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),</span>\
           <span class="p">(</span><span class="s1">&#39;cw_ext_par_ids&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">int64</span><span class="p">[:]),(</span><span class="s1">&#39;cw_ext_lows&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),(</span><span class="s1">&#39;cw_ext_highs&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">[:]),</span>\
           <span class="p">(</span><span class="s1">&#39;global_common&#39;</span><span class="p">,</span><span class="n">nb</span><span class="o">.</span><span class="n">float64</span><span class="p">)])</span>
<span class="k">class</span> <span class="nc">FastPriorInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;simple jitclass to store the various elements of fast prior calculation in a way that can be accessed quickly from a numba environment</span>

<span class="sd">    :param uniform_par_ids:</span>
<span class="sd">    Indices of parameters with uniform prior</span>
<span class="sd">    :param uniform_lows:</span>
<span class="sd">    Lower prior bounds of uniform prior parameters</span>
<span class="sd">    :param uniform_highs:</span>
<span class="sd">    Upper prior bounds of uniform prior parameters</span>
<span class="sd">    :param lin_exp_par_ids:</span>
<span class="sd">    Indices of parameters with linear exponential prior</span>
<span class="sd">    :param lin_exp_lows:</span>
<span class="sd">    Lower prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param lin_exp_highs:</span>
<span class="sd">    Upper prior bounds of linear exponential prior parameters</span>
<span class="sd">    :param normal_par_ids:</span>
<span class="sd">    Indices of parameters with normal prior</span>
<span class="sd">    :param normal_mus:</span>
<span class="sd">    Means of normal prior parameters</span>
<span class="sd">    :param normal_sigs:</span>
<span class="sd">    Standard deviations of normal prior parameters</span>
<span class="sd">    :param dm_par_ids:</span>
<span class="sd">    Indices of parameters with DM distance prior</span>
<span class="sd">    :param dm_dists:</span>
<span class="sd">    Mean distances of DM distance prior parameters</span>
<span class="sd">    :param dm_errs:</span>
<span class="sd">    Errors of DM distance prior parameters</span>
<span class="sd">    :param px_par_ids:</span>
<span class="sd">    Indices of parameters with parallax distance prior</span>
<span class="sd">    :param px_mus:</span>
<span class="sd">    Means of parallax distance prior parameters</span>
<span class="sd">    :param px_errs:</span>
<span class="sd">    Errors of parallax distance prior parameters</span>
<span class="sd">    :param cut_par_ids:</span>
<span class="sd">    Indices of parameters where an extra cut might be needed to stay in prior range (like distance)</span>
<span class="sd">    :param cut_lows:</span>
<span class="sd">    Lower bounds of these parameters</span>
<span class="sd">    :param cut_highs:</span>
<span class="sd">    Upper bounds of these parameters</span>
<span class="sd">    :param cw_ext_par_ids:</span>
<span class="sd">    Indices of projection parameters (previously called extrinsic parameters)</span>
<span class="sd">    :param cw_ext_lows:</span>
<span class="sd">    Lower bounds of extrinsic parameters</span>
<span class="sd">    :param cw_ext_highs:</span>
<span class="sd">    Upper bounds of extrinsic parameters</span>
<span class="sd">    :param global_common:</span>
<span class="sd">    Part of the log prior independent of the parameter values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">uniform_lows</span><span class="p">,</span> <span class="n">uniform_highs</span><span class="p">,</span> <span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">lin_exp_highs</span><span class="p">,</span> <span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">normal_mus</span><span class="p">,</span> <span class="n">normal_sigs</span><span class="p">,</span> <span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">dm_dists</span><span class="p">,</span> <span class="n">dm_errs</span><span class="p">,</span> <span class="n">px_par_ids</span><span class="p">,</span> <span class="n">px_mus</span><span class="p">,</span> <span class="n">px_errs</span><span class="p">,</span> <span class="n">cut_par_ids</span><span class="p">,</span> <span class="n">cut_lows</span><span class="p">,</span> <span class="n">cut_highs</span><span class="p">,</span> <span class="n">cw_ext_par_ids</span><span class="p">,</span> <span class="n">cw_ext_lows</span><span class="p">,</span> <span class="n">cw_ext_highs</span><span class="p">,</span> <span class="n">global_common</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_par_ids</span> <span class="o">=</span> <span class="n">uniform_par_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_lows</span> <span class="o">=</span> <span class="n">uniform_lows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_highs</span> <span class="o">=</span> <span class="n">uniform_highs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_par_ids</span> <span class="o">=</span> <span class="n">lin_exp_par_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_lows</span> <span class="o">=</span> <span class="n">lin_exp_lows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lin_exp_highs</span> <span class="o">=</span> <span class="n">lin_exp_highs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_par_ids</span> <span class="o">=</span> <span class="n">normal_par_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_mus</span> <span class="o">=</span> <span class="n">normal_mus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_sigs</span> <span class="o">=</span> <span class="n">normal_sigs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_par_ids</span> <span class="o">=</span> <span class="n">dm_par_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_dists</span> <span class="o">=</span> <span class="n">dm_dists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dm_errs</span> <span class="o">=</span> <span class="n">dm_errs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_par_ids</span> <span class="o">=</span> <span class="n">px_par_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_mus</span> <span class="o">=</span> <span class="n">px_mus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_errs</span> <span class="o">=</span> <span class="n">px_errs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_par_ids</span> <span class="o">=</span> <span class="n">cut_par_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_lows</span> <span class="o">=</span> <span class="n">cut_lows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_highs</span> <span class="o">=</span> <span class="n">cut_highs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cw_ext_par_ids</span> <span class="o">=</span> <span class="n">cw_ext_par_ids</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cw_ext_lows</span> <span class="o">=</span> <span class="n">cw_ext_lows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cw_ext_highs</span> <span class="o">=</span> <span class="n">cw_ext_highs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_common</span> <span class="o">=</span> <span class="n">global_common</span></div>

<div class="viewcode-block" id="get_FastPriorInfo"><a class="viewcode-back" href="../../QuickCW.html#QuickCW.CWFastPrior.get_FastPriorInfo">[docs]</a><span class="k">def</span> <span class="nf">get_FastPriorInfo</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span><span class="n">psrs</span><span class="p">,</span><span class="n">par_names_cw_ext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;get FastPriorInfo object from pta</span>

<span class="sd">    :param pta:</span>
<span class="sd">    enterprise PTA object</span>
<span class="sd">    :param psrs:</span>
<span class="sd">    List of enterprise pulsar objects</span>
<span class="sd">    :param par_names_cw_ext:</span>
<span class="sd">    List of parameter names which are projection parameters (previously called extrinsic parameters)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fp_loc</span> <span class="o">=</span> <span class="n">FastPrior</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span><span class="n">psrs</span><span class="p">,</span><span class="n">par_names_cw_ext</span><span class="p">)</span>
    <span class="n">FPI</span> <span class="o">=</span> <span class="n">FastPriorInfo</span><span class="p">(</span><span class="n">fp_loc</span><span class="o">.</span><span class="n">uniform_par_ids</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">uniform_lows</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">uniform_highs</span><span class="p">,</span>\
                        <span class="n">fp_loc</span><span class="o">.</span><span class="n">lin_exp_par_ids</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">lin_exp_lows</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">lin_exp_highs</span><span class="p">,</span>\
                        <span class="n">fp_loc</span><span class="o">.</span><span class="n">normal_par_ids</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">normal_mus</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">normal_sigs</span><span class="p">,</span>\
                        <span class="n">fp_loc</span><span class="o">.</span><span class="n">dm_par_ids</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">dm_dists</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">dm_errs</span><span class="p">,</span>\
                        <span class="n">fp_loc</span><span class="o">.</span><span class="n">px_par_ids</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">px_mus</span><span class="p">,</span> <span class="n">fp_loc</span><span class="o">.</span><span class="n">px_errs</span><span class="p">,</span>\
                        <span class="n">fp_loc</span><span class="o">.</span><span class="n">cut_par_ids</span><span class="p">,</span><span class="n">fp_loc</span><span class="o">.</span><span class="n">cut_lows</span><span class="p">,</span><span class="n">fp_loc</span><span class="o">.</span><span class="n">cut_highs</span><span class="p">,</span>\
                        <span class="n">fp_loc</span><span class="o">.</span><span class="n">cw_ext_par_ids</span><span class="p">,</span><span class="n">fp_loc</span><span class="o">.</span><span class="n">cw_ext_lows</span><span class="p">,</span><span class="n">fp_loc</span><span class="o">.</span><span class="n">cw_ext_highs</span><span class="p">,</span>\
                        <span class="n">fp_loc</span><span class="o">.</span><span class="n">global_common</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FPI</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Bence Becsy, Neil Cornish, Matthew Digman.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>